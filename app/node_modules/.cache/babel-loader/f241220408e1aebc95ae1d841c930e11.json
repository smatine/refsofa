{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\ref\\\\referentiel\\\\app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\ref\\\\referentiel\\\\app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"C:\\\\ref\\\\referentiel\\\\app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"C:\\\\ref\\\\referentiel\\\\app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"C:\\\\ref\\\\referentiel\\\\app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\ref\\\\referentiel\\\\app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\ref\\\\referentiel\\\\app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\ref\\\\referentiel\\\\app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\ref\\\\referentiel\\\\app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"C:\\\\ref\\\\referentiel\\\\app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"C:\\\\ref\\\\referentiel\\\\app\\\\src\\\\TargetEdit.js\";\nimport React, { Component } from 'react';\nimport { Link, withRouter } from 'react-router-dom';\nimport { Button, Container, Form, FormGroup, Input, Label, FormFeedback } from 'reactstrap';\nimport AppNavbar from './AppNavbar';\nimport { API_BASE_URL } from './constants';\n\nvar cidrRegex = require('cidr-regex');\n\nvar TargetEdit =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(TargetEdit, _Component);\n\n  function TargetEdit(props) {\n    var _this;\n\n    _classCallCheck(this, TargetEdit);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(TargetEdit).call(this, props));\n    _this.emptyItem = {\n      port: '',\n      targetGroup: {},\n      eccId: '',\n      ecc: {},\n      eccs: [],\n      touched: {\n        port: false,\n        eccId: false\n      }\n    };\n\n    _this.handleBlur = function (field) {\n      return function (evt) {\n        var item = _objectSpread({}, _this.state.item);\n\n        item.touched = _objectSpread({}, _this.state.item.touched, _defineProperty({}, field, true));\n\n        _this.setState({\n          item: item\n        });\n      };\n    };\n\n    _this.state = {\n      item: _this.emptyItem\n    };\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleSubmit = _this.handleSubmit.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleBlur = _this.handleBlur.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(TargetEdit, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var _this2 = this;\n\n        var target, _item, targetGroup, _target, item;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(this.props.match.params.id !== 'new')) {\n                  _context.next = 13;\n                  break;\n                }\n\n                _context.next = 3;\n                return fetch(\"\".concat(API_BASE_URL, \"/targets/\").concat(this.props.match.params.id));\n\n              case 3:\n                _context.next = 5;\n                return _context.sent.json();\n\n              case 5:\n                target = _context.sent;\n                target.touched = {\n                  port: false,\n                  eccId: false\n                };\n                this.setState({\n                  item: target\n                });\n                _item = _objectSpread({}, this.state.item);\n                _item.eccId = target.ecc.id;\n                this.setState({\n                  item: _item\n                });\n                _context.next = 22;\n                break;\n\n              case 13:\n                _context.next = 15;\n                return fetch(\"\".concat(API_BASE_URL, \"/targetGroups/\").concat(this.props.match.params.idt));\n\n              case 15:\n                _context.next = 17;\n                return _context.sent.json();\n\n              case 17:\n                targetGroup = _context.sent;\n                _target = {\n                  port: '',\n                  targetGroup: {},\n                  eccId: '',\n                  ecc: {},\n                  eccs: [],\n                  touched: {\n                    port: false,\n                    eccId: false\n                  }\n                };\n                _target.targetGroup = targetGroup;\n                _target.touched = {\n                  port: false,\n                  eccId: false\n                };\n                this.setState({\n                  item: _target\n                });\n\n              case 22:\n                item = _objectSpread({}, this.state.item);\n                _context.next = 25;\n                return fetch(API_BASE_URL + '/vpcs/' + item.targetGroup.vpc.id + '/eccs').then(function (result) {\n                  return result.json();\n                }).then(function (jsonResult) {\n                  var item = _objectSpread({}, _this2.state.item);\n\n                  item.eccs = jsonResult;\n\n                  _this2.setState({\n                    item: item\n                  });\n                });\n\n              case 25:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      return function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"handleChange\",\n    value: function handleChange(event) {\n      var target = event.target;\n      var value = target.value;\n      var name = target.name;\n\n      var item = _objectSpread({}, this.state.item);\n\n      item[name] = value;\n      this.setState({\n        item: item\n      });\n    }\n  }, {\n    key: \"handleSubmit\",\n    value: function () {\n      var _handleSubmit = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(event) {\n        var item, errors, isDisabled, hist;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                event.preventDefault();\n                item = this.state.item;\n                item.touched = {\n                  port: true,\n                  eccId: true\n                };\n                errors = this.validate(item.port, item.eccId);\n                isDisabled = Object.keys(errors).some(function (x) {\n                  return errors[x];\n                });\n\n                if (!isDisabled) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                this.forceUpdate();\n                return _context2.abrupt(\"return\");\n\n              case 8:\n                item.port = Number(item.port);\n                item.ecc = {\n                  id: item.eccId\n                }; //console.log(\"port\" + item.port);\n                //return;\n\n                hist = API_BASE_URL + '/targetgroup/' + item.targetGroup.id + '/targets';\n                item.targetGroup = {\n                  id: item.targetGroup.id\n                };\n                _context2.next = 14;\n                return fetch(item.id ? API_BASE_URL + '/targetGroups/' + item.targetGroup.id + '/targets/' + item.id : API_BASE_URL + '/targetGroups/' + item.targetGroup.id + '/targets', {\n                  method: item.id ? 'PUT' : 'POST',\n                  headers: {\n                    'Accept': 'application/json',\n                    'Content-Type': 'application/json'\n                  },\n                  body: JSON.stringify(item)\n                });\n\n              case 14:\n                this.props.history.push(hist);\n\n              case 15:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      return function handleSubmit(_x) {\n        return _handleSubmit.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"validate\",\n    value: function validate(port, eccId) {\n      var errors = {\n        port: '',\n        eccId: ''\n      };\n\n      if (this.state.item.touched.eccId && eccId.length === 0) {\n        errors.eccId = 'Ec2 should not be null';\n        return errors;\n      }\n\n      if (this.state.item.touched.port && port.length === 0) {\n        errors.port = 'port should not be null';\n        return errors;\n      }\n\n      return errors;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var item = this.state.item;\n      var title = React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      }, item.id ? 'Edit target' : 'Add target');\n      var errors = this.validate(item.port, item.eccId);\n      var isDisabled = Object.keys(errors).some(function (x) {\n        return errors[x];\n      });\n      var canc = API_BASE_URL + \"/targetgroup/\" + item.targetGroup.id + \"/targets\";\n      var prop = item.propagation;\n      var targetgroup = null;\n      targetgroup = React.createElement(FormGroup, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      }, React.createElement(Label, {\n        for: \"targetgroupId\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165\n        },\n        __self: this\n      }, \"Target Group: \", item.targetGroup.name), React.createElement(Input, {\n        type: \"text\",\n        name: \"targetgroupId\",\n        id: \"targetgroupId\",\n        value: item.targetGroup.id || '',\n        disabled: \"true\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166\n        },\n        __self: this\n      }));\n      var optEccs = [];\n\n      if (item.eccs && item.eccs.length) {\n        item.eccs.map(function (s) {\n          optEccs.push(React.createElement(\"option\", {\n            value: s.id,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 172\n            },\n            __self: this\n          }, s.id, \" \", s.name, \" \", s.subnet.az.name, \" \"));\n        });\n      }\n\n      var ecc = item.eccId || '';\n      item.eccId = ecc;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      }, React.createElement(AppNavbar, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179\n        },\n        __self: this\n      }), React.createElement(Container, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180\n        },\n        __self: this\n      }, title, React.createElement(Form, {\n        onSubmit: this.handleSubmit,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182\n        },\n        __self: this\n      }, targetgroup, React.createElement(FormGroup, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186\n        },\n        __self: this\n      }, React.createElement(Label, {\n        for: \"eccId\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, \"Ec2 (*)\"), React.createElement(Input, {\n        type: \"select\",\n        name: \"eccId\",\n        id: \"eccId\",\n        value: item.eccId || '',\n        placeholder: \"Enter ecc\",\n        onChange: this.handleChange,\n        onBlur: this.handleBlur('eccId'),\n        autoComplete: \"eccId\",\n        valid: errors.eccId === '',\n        invalid: errors.eccId !== '',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, React.createElement(\"option\", {\n        value: \"\",\n        disabled: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, \"Choose\"), optEccs), React.createElement(FormFeedback, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }, errors.eccId)), React.createElement(FormGroup, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }, React.createElement(Label, {\n        for: \"port\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }, \"Port (*)\"), React.createElement(Input, {\n        type: \"number\",\n        name: \"port\",\n        id: \"port\",\n        value: item.port || '',\n        placeholder: \"Enter port\",\n        onChange: this.handleChange,\n        onBlur: this.handleBlur('port'),\n        autoComplete: \"port\",\n        valid: errors.port === '',\n        invalid: errors.port !== '',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }), React.createElement(FormFeedback, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      }, errors.port)), React.createElement(FormGroup, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209\n        },\n        __self: this\n      }, React.createElement(Button, {\n        color: \"primary\",\n        type: \"submit\",\n        disabled: isDisabled,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, \"Save\"), ' ', React.createElement(Button, {\n        color: \"secondary\",\n        tag: Link,\n        to: canc,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211\n        },\n        __self: this\n      }, \"Cancel\")))));\n    }\n  }]);\n\n  return TargetEdit;\n}(Component);\n\nexport default withRouter(TargetEdit);","map":{"version":3,"sources":["C:\\ref\\referentiel\\app\\src\\TargetEdit.js"],"names":["React","Component","Link","withRouter","Button","Container","Form","FormGroup","Input","Label","FormFeedback","AppNavbar","API_BASE_URL","cidrRegex","require","TargetEdit","props","emptyItem","port","targetGroup","eccId","ecc","eccs","touched","handleBlur","field","evt","item","state","setState","handleChange","bind","handleSubmit","match","params","id","fetch","json","target","idt","vpc","then","result","jsonResult","event","value","name","preventDefault","errors","validate","isDisabled","Object","keys","some","x","forceUpdate","Number","hist","method","headers","body","JSON","stringify","history","push","length","title","canc","prop","propagation","targetgroup","optEccs","map","s","subnet","az"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Link, withRouter } from 'react-router-dom';\r\nimport { Button, Container, Form, FormGroup, Input, Label, FormFeedback } from 'reactstrap';\r\nimport AppNavbar from './AppNavbar';\r\nimport { API_BASE_URL } from './constants';\r\nconst cidrRegex = require('cidr-regex');\r\nclass TargetEdit extends Component {\r\n\r\n  emptyItem = {\r\n    \r\n    port: '',\r\n    targetGroup: {},\r\n    eccId:'',\r\n    ecc:{},\r\n    eccs:[],\r\n    touched: {\r\n      \r\n      port: false,\r\n      eccId: false\r\n    }\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      item: this.emptyItem\r\n    };\r\n    this.handleChange = this.handleChange.bind(this);\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n    this.handleBlur = this.handleBlur.bind(this);\r\n  }\r\n\r\n  async componentDidMount() {\r\n    if (this.props.match.params.id !== 'new') {\r\n      const target = await (await fetch(`${API_BASE_URL}/targets/${this.props.match.params.id}`)).json();\r\n      target.touched = {\r\n        port: false,\r\n        eccId: false\r\n      };\r\n      this.setState({item: target});\r\n      let item = {...this.state.item};\r\n      item.eccId = target.ecc.id;\r\n      this.setState({item: item});\r\n      \r\n    }\r\n    else {\r\n      const targetGroup = await (await fetch(`${API_BASE_URL}/targetGroups/${this.props.match.params.idt}`)).json();\r\n      const target = {\r\n          port: '',\r\n          targetGroup: {},\r\n          eccId:'',\r\n          ecc:{},\r\n          eccs:[],\r\n          touched: {\r\n            port: false,\r\n            eccId: false\r\n          }\r\n      };\r\n      target.targetGroup = targetGroup;\r\n      target.touched = {\r\n          port: false,\r\n          eccId: false\r\n      };\r\n      this.setState({item: target});\r\n    }\r\n\r\n    let item = {...this.state.item};\r\n    await fetch(API_BASE_URL + '/vpcs/'  + item.targetGroup.vpc.id + '/eccs',)\r\n    .then((result) => {\r\n      return result.json();\r\n    }).then((jsonResult) => {\r\n      let item = {...this.state.item};\r\n      item.eccs = jsonResult;\r\n      this.setState({item: item});\r\n    });\r\n\r\n  }\r\n\r\n  handleChange(event) {\r\n    const target = event.target;\r\n    const value = target.value;\r\n    const name = target.name;\r\n    let item = {...this.state.item};\r\n    item[name] = value;\r\n    this.setState({item});\r\n\r\n  }\r\n\r\n  async handleSubmit(event) {\r\n    event.preventDefault();\r\n    const {item} = this.state;\r\n\r\n    item.touched = {\r\n          port: true,\r\n          eccId: true\r\n    };\r\n    const errors = this.validate(item.port, item.eccId);\r\n    const isDisabled = Object.keys(errors).some(x => errors[x]);\r\n    if(isDisabled) {\r\n        this.forceUpdate();\r\n        return;\r\n    }\r\n     item.port = Number(item.port);\r\n     item.ecc = {id: item.eccId};\r\n    //console.log(\"port\" + item.port);\r\n    //return;\r\n    const hist= API_BASE_URL + '/targetgroup/' + item.targetGroup.id +'/targets'; \r\n\r\n    item.targetGroup={id: item.targetGroup.id};\r\n    \r\n\r\n    await fetch((item.id) ? API_BASE_URL + '/targetGroups/' + (item.targetGroup.id) + '/targets/'+(item.id) : API_BASE_URL + '/targetGroups/' + (item.targetGroup.id) + '/targets', {\r\n      method: (item.id) ? 'PUT' : 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(item),\r\n    });\r\n    this.props.history.push(hist);\r\n  }\r\n\r\n  handleBlur = (field) => (evt) => {\r\n\r\n    let item = {...this.state.item};\r\n    item.touched= { ...this.state.item.touched, [field]: true};\r\n    this.setState({item});\r\n\r\n  }\r\n\r\n  validate(port, eccId) {\r\n\r\n    const errors = {\r\n      \r\n      port:'',\r\n      eccId:''\r\n    };\r\n    \r\n    if(this.state.item.touched.eccId && eccId.length === 0){\r\n      errors.eccId = 'Ec2 should not be null';\r\n      return errors;\r\n    } \r\n    if(this.state.item.touched.port && port.length === 0){\r\n      errors.port = 'port should not be null';\r\n      return errors;\r\n    } \r\n    \r\n    return errors;\r\n  }\r\n\r\n\r\n  render() {\r\n    const {item} = this.state;\r\n    const title = <h2>{item.id ? 'Edit target' : 'Add target'}</h2>;\r\n\r\n    const errors = this.validate(item.port, item.eccId);\r\n    const isDisabled = Object.keys(errors).some(x => errors[x]);\r\n    \r\n    const canc = API_BASE_URL + \"/targetgroup/\" + item.targetGroup.id + \"/targets\";\r\n\r\n    const prop = item.propagation;\r\n\r\n    let targetgroup = null;\r\n    targetgroup = <FormGroup>\r\n            <Label for=\"targetgroupId\">Target Group: {item.targetGroup.name}</Label>\r\n            <Input type=\"text\" name=\"targetgroupId\" id=\"targetgroupId\" value={item.targetGroup.id || ''} disabled=\"true\"/>\r\n          </FormGroup>;\r\n\r\n    let optEccs = [];\r\n    if(item.eccs && item.eccs.length){\r\n      item.eccs.map(s => {  \r\n          optEccs.push(<option value={s.id}>{s.id} {s.name} {s.subnet.az.name} </option>);\r\n      });\r\n    }\r\n    let ecc = item.eccId || '';\r\n    item.eccId = ecc;\r\n\r\n    return <div>\r\n      <AppNavbar/>\r\n      <Container>\r\n        {title}\r\n        <Form onSubmit={this.handleSubmit}>\r\n\r\n          {targetgroup}\r\n\r\n          <FormGroup>\r\n            <Label for=\"eccId\">Ec2 (*)</Label>\r\n            <Input type=\"select\" name=\"eccId\" id=\"eccId\" value={item.eccId || ''} placeholder=\"Enter ecc\"\r\n                   onChange={this.handleChange} onBlur={this.handleBlur('eccId')} autoComplete=\"eccId\"\r\n                   valid={errors.eccId === ''}\r\n                   invalid={errors.eccId !== ''} >\r\n                   <option value=\"\" disabled>Choose</option>\r\n                   {optEccs}\r\n            </Input>\r\n           <FormFeedback>{errors.eccId}</FormFeedback>\r\n          </FormGroup>\r\n\r\n          <FormGroup>\r\n            <Label for=\"port\">Port (*)</Label>\r\n            <Input type=\"number\" name=\"port\" id=\"port\" value={item.port || ''} placeholder=\"Enter port\"\r\n                   onChange={this.handleChange} onBlur={this.handleBlur('port')} autoComplete=\"port\"\r\n                   valid={errors.port === ''}\r\n                   invalid={errors.port !== ''}\r\n            />\r\n           <FormFeedback>{errors.port}</FormFeedback>\r\n          </FormGroup>\r\n\r\n\r\n          <FormGroup>\r\n            <Button color=\"primary\" type=\"submit\" disabled={isDisabled}>Save</Button>{' '}\r\n            <Button color=\"secondary\" tag={Link} to={canc}>Cancel</Button>\r\n\r\n            \r\n\r\n          </FormGroup>\r\n        </Form>\r\n      </Container>\r\n    </div>\r\n  }\r\n}\r\n\r\nexport default withRouter(TargetEdit);"]},"metadata":{},"sourceType":"module"}